<!DOCTYPE html>
<html>
<head>
    <title>Real-Time Translator</title>
</head>
<body>
    <h1>Real-Time Translator</h1>

    <button onclick="startRecording()">Start Recording</button>
    <button onclick="stopRecording()">Stop Recording</button>

    <audio id="translatedAudio" controls></audio>

    <script>
        let ws;
        let mediaRecorder;
        let audioChunks = [];

        function connectWebSocket() {
            ws = new WebSocket("ws://localhost:8000/ws");
            ws.onmessage = (event) => {
                const audioBlob = new Blob([event.data], { type: "audio/wav" });
                const audioURL = URL.createObjectURL(audioBlob);
                document.getElementById("translatedAudio").src = audioURL;
                document.getElementById("translatedAudio").play();
            };
        }

        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                        if (mediaRecorder.state === "inactive") {
                            const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
                            audioBlob.arrayBuffer().then(buffer => {
                                ws.send(buffer);
                            });
                        }
                    };
                    mediaRecorder.start();
                    connectWebSocket();
                });
        }

        function stopRecording() {
            if (mediaRecorder) {
                mediaRecorder.stop();
            }
        }
    </script>
</body>
</html>
